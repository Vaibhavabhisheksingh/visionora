<% layout("/layouts/boilerplate") %>

<div class="container mt-5">
    <h2 class="mb-4 fw-bold">User Details</h2>

    <div class="card shadow-sm p-4 rounded-4 position-relative">
        <i class="fa-solid fa-circle-user fa-4x mb-3"></i>
        <h4 class="fw-bold"><%= user.username %></h4>
        <p class="text-muted"><%= user.email %></p>

        <!-- Delete Button -->
        <button class="btn btn-danger mt-3" data-bs-toggle="modal" data-bs-target="#deleteUserModal">
            <i class="fa-solid fa-trash"></i> Delete User
        </button>
    </div>

    <!-- User Orders -->
    <h4 class="mt-5 mb-3">Orders</h4>
    <% if(userOrders.length === 0) { %>
        <p class="text-muted">No orders found.</p>
    <% } else { %>
        <div class="row g-3">
            <% userOrders.forEach(order => { %>
                <div class="col-md-4">
                    <div class="card shadow-sm p-3 rounded-4">
                        <h6>Order : <%= order.product.title %></h6>
                        <p>Status: <%= order.status %></p>
                        <p>Total: ₹<%= order.price %></p>
                        <p>Price: ₹ <%= order.listing ? order.listing.price : order.price %></p>
                    </div>
                </div>
            <% }) %>
        </div>
    <% } %>

    <!-- User Appointments -->
    <h4 class="mt-5 mb-3">Appointments</h4>
    <% if (userAppointments.length === 0) { %>
        <p class="text-muted">No appointments found.</p>
    <% } else { %>
        <% userAppointments.forEach(appointment => { %>
            <div class="card shadow-sm p-3 rounded-4 mb-3">
                <h6>Doctor : <%= appointment.specialist.name %></h6>
                <p>Location : <%= appointment.specialist.location %></p>
                <p>Date: <%= appointment.appointmentTime ? new Date(appointment.appointmentTime).toLocaleString() : "N/A" %></p>
            </div>
        <% }) %>
    <% } %>

</div>


<!-- ============================= -->
<!-- Bootstrap Delete Confirmation -->
<!-- ============================= -->

<div class="modal fade" id="deleteUserModal" tabindex="-1" aria-labelledby="deleteUserModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content rounded-4">
      
      <div class="modal-header">
        <h5 class="modal-title fw-bold" id="deleteUserModalLabel">Confirm Deletion</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>

      <div class="modal-body">
        <p class="mb-0 fw-semibold">Are you sure you want to delete this user?</p>
        <p class="text-danger fw-bold mt-1">All related data (orders, reviews, appointments) will also be deleted.</p>
      </div>

      <div class="modal-footer">
        <button type="button" class="btn btn-secondary rounded-pill" data-bs-dismiss="modal">Cancel</button>

        <form action="/admin/users/<%= user._id %>?_method=DELETE" method="POST">
            <button type="submit" class="btn btn-danger rounded-pill">
                <i class="fa-solid fa-trash"></i> Delete User
            </button>
        </form>
      </div>

    </div>
  </div>
</div>
